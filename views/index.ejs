
<%- include("partials/header.ejs") %>
<body>
    <div id="header">
        <div class="logo">
            <img src="images/neu logo.png" alt="NEU logo"> 
        </div>
        <div class="title">
            <h3>NEAR EAST UNIVERSITY</h3>
        </div>
    </div>
    <div id="map-container">
        <div id="map"></div>
    
        <div class="routes">
            <div id="route-header"> <img src="images/map.png" alt="map logo" height="30px"><h3>Bus Routes</h3></div>
            <div class="route-name"> <input type="radio" name="route" id="1"><label for="1">Lefkoşa 1</label> </div>
            <div class="route-name"> <input type="radio" name="route" id="2"><label for="2">Lefkoşa 2</label> </div>
            <div class="route-name"> <input type="radio" name="route" id="3"><label for="3">Kızılbaş</label> </div>
            <div class="route-name"> <input type="radio" name="route" id="4"><label for="4">Gönyeli 1</label> </div>
            <div class="route-name"> <input type="radio" name="route" id="5"><label for="5">Gönyeli 2</label> </div>
            <div class="route-name"> <input type="radio" name="route" id="6"><label for="6">Gönyeli / Metehan</label> </div>
            <div class="route-name"> <input type="radio" name="route" id="7"><label for="7">Ortaköy / Yenikent</label> </div>
            <div class="route-name"> <input type="radio" name="route" id="8"><label for="8">Campus - Kyrenia</label> </div>
            <div class="route-name"> <input type="radio" name="route" id="9"><label for="9">Campus - Güzelyurt</label> </div>
            <div class="route-name"> <input type="radio" name="route" id="10"><label for="10">Campus - Famagusta</label> </div>
        </div>
    </div>
    <div id="form">
        <form action="/track" method="get">
            <p>Click here to start tracking :</p><button type="submit"> track</button>
        </form>
    </div>
</body>
    <script>
        let map;
        let marker;
        let directionsService;
        let directionsRenderer;
        let waypointsData = {
            "1": [
                { lat: 35.2297, lng: 33.3245 },
                { lat: 35.2261, lng: 33.3255 },
                { lat: 35.2106, lng: 33.3436 },
                { lat: 35.211, lng: 33.3707 },
                { lat: 35.2113, lng: 33.3758 },
                { lat: 35.2093, lng: 33.3667 },
                { lat: 35.2021, lng: 33.3674 },
                { lat: 35.199, lng: 33.3678 },
                { lat: 35.1948, lng: 33.3678 },
                { lat: 35.2263, lng: 33.3261},
                { lat: 35.188, lng: 33.3661 },
                { lat: 35.2297, lng: 33.3246}
            ],
            "2": [
                { lat: 35.2297, lng: 33.3245 },
                { lat: 35.2261, lng: 33.3255 },
                { lat: 35.1867, lng: 33.3655 },
                { lat: 35.1823, lng: 33.3624 },
                { lat: 35.1859, lng: 33.3573 },
                { lat: 35.1907, lng: 33.3519 },
                { lat: 35.1941, lng: 33.3482 },
                { lat: 35.1998, lng: 33.3407 },
                { lat: 35.2051, lng: 33.3302 },
                { lat: 35.2263, lng: 33.3261 },
                { lat: 35.2297, lng: 33.3246 }

            ],
            "3": [
                { lat: 35.2297, lng: 33.3245 },
                { lat: 35.2261, lng: 33.3255 },
                { lat: 35.2031, lng: 33.3513 },
                { lat: 35.1993, lng: 33.3568 },
                { lat: 35.2025, lng: 33.3639 },
                { lat: 35.2034, lng: 33.3688 },
                { lat: 35.2032, lng: 33.3732 },
                { lat: 35.203, lng: 33.3768 },
                { lat: 35.2087, lng: 33.3787 },
                { lat: 35.2157, lng: 33.3782 },
                { lat: 35.2202, lng: 33.3774 },
                { lat: 35.2263, lng: 33.3261 },
                { lat: 35.2297, lng: 33.3246 }
            ],
            "4": [
                { lat: 35.2297, lng: 33.3245 },
                { lat: 35.2261, lng: 33.3255 },
                { lat: 35.2094, lng: 33.2983 },
                { lat: 35.2087, lng: 33.3074 },
                { lat: 35.2118, lng: 33.3072 },
                { lat: 35.2147, lng: 33.308 },
                { lat: 35.2124, lng: 33.3108 },
                { lat: 35.2103, lng: 33.3147 },
                { lat: 35.2093, lng: 33.3184 },
                { lat: 35.2127, lng: 33.3342},
                { lat: 35.2263, lng: 33.3261 },
                { lat: 35.2297, lng: 33.3246}
            ],
            "5": [
                { lat: 35.2297, lng: 33.3245 },
                { lat: 35.2261, lng: 33.3255 },
                { lat: 35.21, lng: 33.3149 },
                { lat: 35.2123, lng: 33.3108 },
                { lat: 35.2182, lng: 33.3034 },
                { lat: 35.2217, lng: 33.3009 },
                { lat: 35.2256, lng: 33.2984 },
                { lat: 35.2263, lng: 33.3261 },
                { lat: 35.2297, lng: 33.3246 }
            ],
            "6": [
                { lat: 35.2297, lng: 33.3243 },
                { lat: 35.2261, lng: 33.3255 },
                { lat: 35.2086, lng: 33.3185 },
                { lat: 35.208, lng: 33.3135 },
                { lat: 35.2083, lng: 33.3074 },
                { lat: 35.2101, lng: 33.2934 },
                { lat: 35.1981, lng: 33.3117 },
                { lat: 35.1938, lng: 33.3211 },
                { lat: 35.1914, lng: 33.3256 },
                { lat: 35.2018, lng: 33.3223 },
                { lat: 35.205, lng: 33.3173 },
                { lat: 35.2088, lng: 33.3182 },
                { lat: 35.2263, lng: 33.3261 },
                { lat: 35.2297, lng: 33.3246 }
            ],
            "7": [
                { lat: 35.2297, lng: 33.3244 },
                { lat: 35.2259, lng: 33.3257 },
                { lat: 35.2077, lng: 33.3399 },
                { lat: 35.2009, lng: 33.3412 },
                { lat: 35.1986, lng: 33.3338 },
                { lat: 35.1969, lng: 33.3311 },
                { lat: 35.1991, lng: 33.3272 },
                { lat: 35.2011, lng: 33.3236 },
                { lat: 35.2263, lng: 33.3261 },
                { lat: 35.2297, lng: 33.3246 }
            ],
            "8": [
                { lat: 35.3326, lng: 33.3144 },
                { lat: 35.3304, lng: 33.3257 },
                { lat: 35.3338, lng: 33.3325 },
                { lat: 35.3342, lng: 33.3404 },
                { lat: 35.3338, lng: 33.3316 },
                { lat: 35.33, lng: 33.3274 },
                { lat: 35.2858, lng: 33.2796 },
                { lat: 35.2297, lng: 33.3246 }
            ],
            "9": [
                { lat: 35.1929, lng: 32.9947 },
                { lat: 35.2297, lng: 33.3246 }
            ],
            "10": [
                { lat: 35.1204, lng: 33.9376},
                { lat: 35.2297, lng: 33.3246 }
            ]
            // Add waypoints for other routes as needed
        };

        function initMap() {
            const coordinates = { lat: 35.2268056, lng: 33.3202778 };
            map = new google.maps.Map(document.getElementById('map'), {
                center: coordinates,
                zoom: 15
            });

            const busIcon = {
                url: '/images/bus.png',
                scaledSize: new google.maps.Size(50, 50),
                origin: new google.maps.Point(0, 0),
                anchor: new google.maps.Point(25, 50)
            };
            const stopIcon = {
                url: '/images/busStop.png',
                scaledSize: new google.maps.Size(50, 50),
                origin: new google.maps.Point(0, 0),
                anchor: new google.maps.Point(25, 50)
            };

            marker = new google.maps.Marker({
                position: coordinates,
                map: map,
                title: 'Initial Location',
                icon: busIcon
            });

            // Initialize the directions service and renderer
            directionsService = new google.maps.DirectionsService();
            directionsRenderer = new google.maps.DirectionsRenderer({
                map: map,
                polylineOptions: {
                    strokeColor: '#8F2A46',
                    strokeWeight: 4
                }
            });

            // Add event listeners to radio buttons
            const radioButtons = document.querySelectorAll('input[type=radio][name=route]');
            radioButtons.forEach(button => {
                button.addEventListener('change', function() {
                    if (this.checked) {
                        const routeId = this.id;
                        const waypoints = waypointsData[routeId];
                        if (waypoints) {
                            const start = waypoints[0];
                            const end = waypoints[waypoints.length - 1];
                            calculateAndDisplayRoute(start, end, waypoints);
                        }
                    }
                });
            });

            // Default route to display
            const defaultRouteId = '1';
            const defaultWaypoints = waypointsData[defaultRouteId];
            const start = defaultWaypoints[0];
            const end = defaultWaypoints[defaultWaypoints.length - 1];
            calculateAndDisplayRoute(start, end, defaultWaypoints);

            // Start the tracking
            // ();
        }

        function calculateAndDisplayRoute(start, end, waypoints) {
            const waypts = waypoints.slice(1, -1).map(point => ({
                location: new google.maps.LatLng(point.lat, point.lng),
                stopover: true
            }));
            
            directionsService.route({
                origin: new google.maps.LatLng(start.lat, start.lng),
                destination: new google.maps.LatLng(end.lat, end.lng),
                waypoints: waypts,
                optimizeWaypoints: false,
                travelMode: google.maps.TravelMode.DRIVING
            }, function(response, status) {
                if (status === google.maps.DirectionsStatus.OK) {
                    directionsRenderer.setDirections(response);
                } else {
                    window.alert('Directions request failed due to ' + status);
                }
            });
        }

        /*
        function updateMap(lat, lng) {
            const newCoordinates = { lat, lng };
            map.setCenter(newCoordinates);
            marker.setPosition(newCoordinates);
        }

        async function fetchCoordinates() {
            try {
                const response = await fetch('/track');
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error fetching coordinates:', error);
                }
        }

        function  () {
            setInterval(async () => {
                const coordinates = await fetchCoordinates();
                if (coordinates) {
                    updateMap(coordinates.lat, coordinates.lng);
                }
            }, 1000); // Fetch new coordinates every seconds
        } */

        window.initMap = initMap;
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAN7RgjsbeM0aOcEk6zS8IEH-0AfxiJj9s&callback=initMap"></script>
</body>
</html>
